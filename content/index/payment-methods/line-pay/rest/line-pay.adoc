[#API_LinePay]
== REST API

_LINE Pay_ is a type of <<PaymentMethods_PaymentMode_Wallet, Wallet>> payment.

// vhauss >>>>> Don't forget to add LINE Pay to the online payment methods and the other payment method lists:
// see table under #API_PM_APM_PaymentMode

[#API_LinePay_Introduction_General]
=== General Information

[#API_LinePay_Introduction_General_PaymentMode]
==== Countries and Currencies

[width=75%,cols="1h,3",stripes=none]
|===
| Countries    | Thailand
| Currencies   | USD, JPY, TWD, THB
|===

//-

[#API_LinePay_Introduction_General_CommunicationFormats]
==== Communication Formats

This table illustrates how _LINE Pay_ notifications are encoded and which formats and methods can be used for
requests and responses.
[width=75%,stripes=none]
|===
.2+h| Requests/Responses | Format   | XML
                         | Methods  | POST
   h| IPN Encodement   2+| Follow the instructions given at
<<GeneralPlatformFeatures_IPN_NotificationExamples, Instant Payment Notification>> to set up IPN.
|===

[#API_LinePay_TransactionTypes]
=== Transaction Types

For <<Glossary_TransactionType, transaction type>> details look at <<AppendixB,  Transaction Types>>.

[%autowidth.stretch,stripes=none]
|===
|Transaction Type |Link to the sample

| _pending-debit_ | <<API_LinePay_Samples_PendingDebit, _pending-debit_ sample>>
| _debit_ | <<API_LinePay_Samples_PendingDebit_RecRec, _debit_ sample>>
| _refund-debit_ | <<API_LinePay_Samples_RefundDebit, _refund-debit_ sample>>
| _pending-authorization_ | <<API_LinePay_Samples_PendingAuth, _pending-authorization_ sample>>
| _void-authorization_ | <<API_LinePay_Samples_VoidAuth, _void-authorization_ sample>>
| _capture-authorization_ | <<API_LinePay_Samples_CaptureAuth, _capture-authorization_ sample>>
| _refund-capture_ | <<API_LinePay_Samples_RefundCapture, _refund-capture_ sample>>

|===

//-

[#API_LinePay_TestCredentials]
=== Test Credentials

// [%autowidth.stretch,stripes=none]
// |===
// h|Endpoint | ``\https://{rest-api-test-apm-endpoint}``
// h|Merchant Account ID (MAID) | 9a04f328-ea7e-487c-bccd-87fd56f0dc09
// h|Username |16390-testing
// h|Password |3!3013=D3fD8X7
// |===

For LINE Pay we cannot provide a general set of test credentials. For a successful test you must register to LINE Pay's platform. Additionally, depending on your use cases, LINE Pay configures an individual set of features tailored for you. +
Ask <<ContactUs, Merchant Support>> for details.

[#API_LinePay_Workflow]
=== Workflow

image::images/line-pay/linepay-flow.jpg[LINE Pay payment flow, height=400]

==== pending-debit or pending-authorization

The workflow depends on the device with which the consumer performs the payment process.

.Consumer uses a PC

image::images/line-pay/Fig-3_pc_payment-reservation-process.jpg[LINE Pay pc payment reservation, height=400]

. The consumer selects LINE Pay in the checkout page of your online shop.                   
. WPG calls LINE Pay's "Payment Reserve API" to create payment reservation information.
// Which transaction type is used here?
. LINE Pay sends a ``transaction-id`` and a ``payment-method @Url`` to WPG. The ``transaction-id`` is required to confirm the payment. 
. WPG send the ``payment-method @Url`` to the consumer's device.
. The consumer goes through channel web login to authenticate as a LINE user. (This is a process of verifying if the user LINE before using services. The channel web login process is skipped if WPG can access the LINE user information and forward mid when reserving payment.) 
. LINE Pay pushes a payment request to LINE after the user successfully logs in to LINE.
. LINE Pay sends a debit or authorization notification of the payment request to the consumer's LINE app and moves the consumer to the payment screen.

.Consumer uses a mobile device

image::images/line-pay/Fig-4_mobile_payment-reservation-process.jpg[LINE Pay pc payment reservation, height=400]

. The consumer selects LINE Pay in the checkout page of your online shop.                 
. WPG call LINE Pay's "Payment Reserve API" to create payment reservation information.
. LINE Pay sends a ``transaction-id`` and a ``payment-method @Url`` to WPG. The ``transaction-id`` is required to confirm the payment. 
. WPG sends the ``payment-method @Url`` to the consumer's device.
. You Use the paymentUrl to redirect the consumer to the payment screen in the LINE Pay app. The paymentUrl is divided into web and app, depending on the integration environment.
. You check, whether the consumer has installed the LINE Pay app.
• web: LINE Pay provides a web screen. The Merchant checks whether the app is installed before redirecting the user to LINE Pay payment screen.
• app: An app scheme URL to directly move to the LINE Pay payment screen. For how to check whether the LINE app is installed and available versions of LINE Pay (for Android only), please refer to "How to use PaymentUrl App Guide." 

==== Payment Completion (debit?)
// Is this a debit?

After selecting a payment method (credit card or balance) to process the payment, the LINE Pay user moves to the "confirmUrl" (added by transactionId in LINE Pay) received from the Merchant when the payment is reserved. Then, the Merchant calls the "Payment confirm API " to complete the payment.

.PC: Payment completion

image::images/line-pay/Fig-5_pc_payment-completion.jpg[LINE Pay pc payment reservation, height=400]

. The consumer selects LINE Pay in the checkout page of your online shop and enters the password. 
. LINE Pay stores the payment method information and sets the payment status to ‘authorized’. 
. The consumer checks the payment information screen. 
. When the transaction becomes payable on the awaiting payment screen, the user is redirected to the "confirmUrl" received from the Merchant when the payment is reserved. 
// Is the confirmURL = redirect URL (either success or fail)?
// Who redirects the consumer to the confirmURL?
. The Merchant calls the Confirm Payment API to complete the payment. 

.Mobile: Payment completion

image::images/line-pay/Fig-6_mobile_payment-completion.jpg[LINE Pay pc payment reservation, height=400]

. The consumer selects LINE Pay in the checkout page of your online shop and enters the password. 
. LINE Pay stores the payment method information and sets the payment status to ‘authorized’. 
. After checking the payment information screen on the LINE app, the consumer clicks ‘OK’ on the bottom to move to the "confirmUrl" received when the payment is reserved. 
. The Merchant calls the Confirm Payment API to complete the payment. 

==== Preapproved Payment (authorization?)

Payment Request - Payment Screen 

The overall flow is the same as the normal payment, except that the transaction type is ``authorization`` 

// The overall flow is the same as the normal payment, except that "payType" should be set as "PREAPPROVED." 

Payment Screen - Payment Completion and regKey (for preapproved payment) Issuance 

A regKey is delivered with the response information of payment confirmation additionally. The Merchant must save this key to use preapproved payment later. 
// is the regKey = parent-transaction-id?

Preapproved Payment 

image::images/line-pay/Fig-9_preapproved-payment.jpg[LINE Pay pc payment reservation, height=400]

When the payment is confirmed, you send a capture request which contains the transaction-id from the corresponding authorization in the field parent-transaction-id.
// Who confirms the payment and how?
// When the payment is confirmed, the Merchant server calls "Preapproved Payment API" by using the regKey to make a payment. The LINE Pay user does not intervene during the payment process, but can be notified when the payment is completed. 

regKey (for Preapproved Payment) Expiration 

You can call the Expire regKey API so that unnecessary regKeys expire. For more information, refer to “Expire regKey” 

==== Capture Payment 

You capture a payment in two steps. First you authorize the payment and then you capture it.
//When the authorization of payment is separated from the capture of the authorized payment.

The overall process is similar to those above, but the Merchant should set "capture" to "false" in the authorization request. 
// The overall process is similar to those above, but the Merchant should set "capture" as "false" when calling the Reserve Payment API. 

After receiving a succesful authorization response you can either capture the payment or void the authorization.
// When the Merchant calls the Confirm Payment API, the payment status is saved as AUTHORIZATION. 

// When capturing the payment, 
// • To capture the payment: Call the Capture API to complete the payment. 
// • Not to capture the payment: Call the Void Authorization API to cancel the authorization of payment. 

// How to refund a capture?
// How to refund a debit?

==== Server to server communication (Do we need this in the Merchant spec?)

When calling confirmUrl from Server to Server 

The payment can be made by only the communication between the Merchant server and the LINE Pay server, with delivering confirmUrl.

.Prior Conditions 

oneTimeKey Valid Time : 10 minutes (From the time that user approaches to the oneTimeKey code page.) 
oneTimeKey and Payment reserve will be deleted at the same time 

Integration Flow 

Figure 8 OneTimeKeyIssuance and Payment reserve 

. Merchant reads oneTimeKey code (barcode or QR Code) that LINE Pay user shows. 
. Merchant reserves Payment with oneTimeKey information that Merchant gets. 
. After Payment reserve process completes, LINE Pay user confirms Payment Request via LINE. 
. LINE Pay user selects a Payment method on the Payment Screen and Enters a Password on the same screen. 
. After LINE Pay user checks a payment information screen, For reserving a payment, the flow is different depending on confirmUrlType. 
• CLIENT(Default Value) : ConfirmUrl opens on an user’s browser. After directing to the browser, calling a payment confirm API; it completes a payment. 
• SERVER : [Appendix] Please refer to “When Calling ConfirmURL from Server-to-Server” 

.Confirming payment

Merchant Server calls Payment Confirm API and completes a Payment process. When incorrect response is occurred from ConfirmUrl, Merchant cannot call Confirm API.

. When reserving the payment, the Merchant should pass confirmUrlType : "SERVER". 
. The LINE Pay user selects a payment method and enters the password after entering the LINE Pay payment screen. 
. The LINE Pay server saves the payment information and calls the confirmUrl received from the Merchant when the payment is reserved. [Appendix] “Please refer to the case of Calling Confirm Url from Server-to-Server” 
. The Merchant server calls the Confirm Payment API to complete the payment. Please note that the Merchant server can call the Confirm Payment API only after the response for the ConfirmUrl is successfully sent. 


[#API_LinePay_Fields]
=== Fields

Find details for the fields in the <<RestApi_Fields, REST API Field Table>>.

[#API_LinePay_Samples]
=== Samples

[#API_LinePay_Samples_PendingDebit]
==== _pending-debit_

.XML Request (Successful)

[source,xml,subs=attributes+]
----
<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<payment xmlns="http://www.elastic-payments.com/schema/payment">
  <merchant-account-id>9a04f328-ea7e-487c-bccd-87fd56f0dc09</merchant-account-id>
  <request-id>{{$guid}}</request-id>
  <transaction-type>pending-debit</transaction-type>
  <requested-amount currency="THB">40.00</requested-amount>
  <account-holder>
    <first-name>Paul</first-name>
    <last-name>Peterson</last-name>
  </account-holder>
  <order-number>1549286434185</order-number>
  <descriptor>Payment description</descriptor>
  <payment-methods>
    <payment-method name="linepay" />
  </payment-methods>
  <cancel-redirect-url>https://{pp-redirect-url-cancel}</cancel-redirect-url>
  <success-redirect-url>https://{pp-redirect-url-success}</success-redirect-url>
</payment>
----

// include::{root}/samples/xml/_request_success.xml[]

.XML Response (Successful)

[source,xml,subs=attributes+]
----
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<payment xmlns="http://www.elastic-payments.com/schema/payment">
    <merchant-account-id>9a04f328-ea7e-487c-bccd-87fd56f0dc09</merchant-account-id>
    <transaction-id>d8dede27-ff91-43cf-95f8-b60040680c6b</transaction-id>
    <request-id>c0b424e6-310e-4aa7-b9c4-ba27a972e2a7</request-id>
    <transaction-type>pending-debit</transaction-type>
    <transaction-state>success</transaction-state>
    <completion-time-stamp>2020-06-30T08:06:08.000Z</completion-time-stamp>
    <statuses>
        <status code="201.0000" description="The resource was successfully created." severity="information"/>
    </statuses>
    <requested-amount currency="THB">40.00</requested-amount>
    <account-holder>
        <first-name>Paul</first-name>
        <last-name>Peterson</last-name>
    </account-holder>
    <order-number>1549286434185</order-number>
    <descriptor>Payment description</descriptor>
    <payment-methods>
        <payment-method url="https://demo2.2c2p.com:443/2C2PFrontEnd/SecurePayment/PaymentAuth.aspx?paymentRequest=PFBheW1lbnRSZXF1ZXN0Pjx2ZXJzaW9uPjkuNjwvdmVyc2lvbj48dGltZVN0YW1wPjMwMDYyMDA4MDYwODwvdGltZVN0YW1wPjxtZXJjaGFudElEPm51bGw8L21lcmNoYW50SUQ%2BPHVuaXF1ZVRyYW5zYWN0aW9uQ29kZT4yOTEyNjQ4NTE0NjM2MDY3MzY2MjwvdW5pcXVlVHJhbnNhY3Rpb25Db2RlPjxkZXNjPk4uQTwvZGVzYz48YW10PjAwMDAwMDAwNDAwMDwvYW10PjxjdXJyZW5jeUNvZGU%2BNzY0PC9jdXJyZW5jeUNvZGU%2BPHBheW1lbnRDaGFubmVsPkxJTkU8L3BheW1lbnRDaGFubmVsPjxhZ2VudENvZGU%2BPC9hZ2VudENvZGU%2BPGNoYW5uZWxDb2RlPldFQlBBWTwvY2hhbm5lbENvZGU%2BPG1vYmlsZU5vPjwvbW9iaWxlTm8%2BPGNhcmRob2xkZXJOYW1lPkpvaG48L2NhcmRob2xkZXJOYW1lPjxjYXJkaG9sZGVyRW1haWw%2BPC9jYXJkaG9sZGVyRW1haWw%2BPHVzZXJEZWZpbmVkMT5kOGRlZGUyNy1mZjkxLTQzY2YtOTVmOC1iNjAwNDA2ODBjNmI8L3VzZXJEZWZpbmVkMT48dXNlckRlZmluZWQyPjE1NDkyODY0MzQxODU8L3VzZXJEZWZpbmVkMj48dXNlckRlZmluZWQzPmMwYjQyNGU2LTMxMGUtNGFhNy1iOWM0LWJhMjdhOTcyZTJhNzwvdXNlckRlZmluZWQzPjx1c2VyRGVmaW5lZDQ%2BOWEwNGYzMjgtZWE3ZS00ODdjLWJjY2QtODdmZDU2ZjBkYzA5PC91c2VyRGVmaW5lZDQ%2BPHNlY3VyZUhhc2g%2BNTVBMzcxOTI1OUUzQzM5Q0YzQTk1ODRGRjdGMjQyMjJBODk0QjRFRTwvc2VjdXJlSGFzaD48L1BheW1lbnRSZXF1ZXN0Pg%3D%3D" name="linepay"/>
    </payment-methods>
    <cancel-redirect-url>https://{pp-redirect-url-cancel}</cancel-redirect-url>
    <success-redirect-url>https://{pp-redirect-url-success}</success-redirect-url>
</payment>
----

// include::{root}/samples/xml/_response_success.xml[]

[#API_LinePay_Samples_PendingDebit_RecFirst]
==== _pending-debit_ (Recurring/First) 

.XML Request (Successful)

[source,xml,subs=attributes+]
----
<payment xmlns="http://www.elastic-payments.com/schema/payment">
  <merchant-account-id>9a04f328-ea7e-487c-bccd-87fd56f0dc09</merchant-account-id>
  <request-id>{{$guid}}</request-id>
  <transaction-type>pending-debit</transaction-type>
  <requested-amount currency="THB">2.00</requested-amount>
  <account-holder>
    <first-name>Paul</first-name>
    <last-name>Peterson</last-name>
  </account-holder>
  <order-number>1551342687432</order-number>
  <descriptor>Payment description</descriptor>
  <payment-methods>
    <payment-method name="linepay"/>
  </payment-methods>
  <periodic>
    <periodic-type>recurring</periodic-type>
    <sequence-type>first</sequence-type>
  </periodic>
  <cancel-redirect-url>https://{pp-redirect-url-cancel}</cancel-redirect-url>
  <success-redirect-url>https://{pp-redirect-url-success}</success-redirect-url>
</payment>
----

// include::{root}/samples/xml/_request_success.xml[]

.XML Response (Successful)

[source,xml,subs=attributes+]
----
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<payment xmlns="http://www.elastic-payments.com/schema/payment">
    <merchant-account-id>9a04f328-ea7e-487c-bccd-87fd56f0dc09</merchant-account-id>
    <transaction-id>92db460a-905b-432e-9105-36ebd86282bf</transaction-id>
    <request-id>a0e8035c-dcfe-4513-914f-40dad5a6385f</request-id>
    <transaction-type>pending-debit</transaction-type>
    <transaction-state>success</transaction-state>
    <completion-time-stamp>2020-06-30T11:15:08.000Z</completion-time-stamp>
    <statuses>
        <status code="201.0000" description="The resource was successfully created." severity="information"/>
    </statuses>
    <requested-amount currency="THB">2.00</requested-amount>
    <account-holder>
        <first-name>Paul</first-name>
        <last-name>Peterson</last-name>
    </account-holder>
    <order-number>1551342687432</order-number>
    <descriptor>Payment description</descriptor>
    <payment-methods>
        <payment-method url="https://demo2.2c2p.com:443/2C2PFrontEnd/SecurePayment/PaymentAuth.aspx?paymentRequest=PFBheW1lbnRSZXF1ZXN0Pjx2ZXJzaW9uPjkuNjwvdmVyc2lvbj48dGltZVN0YW1wPjMwMDYyMDExMTUwNzwvdGltZVN0YW1wPjxtZXJjaGFudElEPm51bGw8L21lcmNoYW50SUQ%2BPHVuaXF1ZVRyYW5zYWN0aW9uQ29kZT42NTU4NzQ0NjA0OTE2NDI4NzA4NzwvdW5pcXVlVHJhbnNhY3Rpb25Db2RlPjxkZXNjPk4uQTwvZGVzYz48YW10PjAwMDAwMDAwMDIwMDwvYW10PjxjdXJyZW5jeUNvZGU%2BNzY0PC9jdXJyZW5jeUNvZGU%2BPHBheW1lbnRDaGFubmVsPkxJTkU8L3BheW1lbnRDaGFubmVsPjxhZ2VudENvZGU%2BPC9hZ2VudENvZGU%2BPGNoYW5uZWxDb2RlPldFQlBBWTwvY2hhbm5lbENvZGU%2BPG1vYmlsZU5vPjwvbW9iaWxlTm8%2BPGNhcmRob2xkZXJOYW1lPkpvaG48L2NhcmRob2xkZXJOYW1lPjxjYXJkaG9sZGVyRW1haWw%2BPC9jYXJkaG9sZGVyRW1haWw%2BPHVzZXJEZWZpbmVkMT45MmRiNDYwYS05MDViLTQzMmUtOTEwNS0zNmViZDg2MjgyYmY8L3VzZXJEZWZpbmVkMT48dXNlckRlZmluZWQyPjE1NTEzNDI2ODc0MzI8L3VzZXJEZWZpbmVkMj48dXNlckRlZmluZWQzPmEwZTgwMzVjLWRjZmUtNDUxMy05MTRmLTQwZGFkNWE2Mzg1ZjwvdXNlckRlZmluZWQzPjx1c2VyRGVmaW5lZDQ%2BOWEwNGYzMjgtZWE3ZS00ODdjLWJjY2QtODdmZDU2ZjBkYzA5PC91c2VyRGVmaW5lZDQ%2BPHNlY3VyZUhhc2g%2BQUVFRjMxM0Q1QTE1RkQ4Qjc0OEY0QkU1REY1MUNFOTcyMTY2ODA0NTwvc2VjdXJlSGFzaD48L1BheW1lbnRSZXF1ZXN0Pg%3D%3D" name="linepay"/>
    </payment-methods>
    <cancel-redirect-url>https://{pp-redirect-url-cancel}</cancel-redirect-url>
    <success-redirect-url>https://{pp-redirect-url-success}</success-redirect-url>
    <periodic>
        <periodic-type>recurring</periodic-type>
        <sequence-type>first</sequence-type>
    </periodic>
</payment>
----

// include::{root}/samples/xml/_response_success.xml[]

[#API_LinePay_Samples_PendingDebit_RecRec]
==== _debit_ (Recurring/Recurring) 

.XML Request (Successful)

[source,xml,subs=attributes+]
----
<payment xmlns="http://www.elastic-payments.com/schema/payment">
  <merchant-account-id>9a04f328-ea7e-487c-bccd-87fd56f0dc09</merchant-account-id>
  <request-id>{{$guid}}</request-id>
  <transaction-type>debit</transaction-type>
  <parent-transaction-id>92db460a-905b-432e-9105-36ebd86282bf</parent-transaction-id>
  <payment-methods>
    <payment-method name="linepay"/>
  </payment-methods>
  <periodic>
    <periodic-type>recurring</periodic-type>
    <sequence-type>recurring</sequence-type>
  </periodic>
</payment>
----

// include::{root}/samples/xml/_request_success.xml[]

.XML Response (Successful)

[source,xml,subs=attributes+]
----
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<payment xmlns="http://www.elastic-payments.com/schema/payment">
    <merchant-account-id>9a04f328-ea7e-487c-bccd-87fd56f0dc09</merchant-account-id>
    <transaction-id>8ea5fb2d-2e2d-4177-95fc-491035b726b2</transaction-id>
    <request-id>b13fc069-c0bd-4db5-888f-52109c498218</request-id>
    <transaction-type>debit</transaction-type>
    <transaction-state>success</transaction-state>
    <completion-time-stamp>2020-06-30T11:16:33.000Z</completion-time-stamp>
    <statuses>
        <status code="201.0000" description="The resource was successfully created." severity="information"/>
    </statuses>
    <requested-amount currency="THB">2.00</requested-amount>
    <parent-transaction-id>92db460a-905b-432e-9105-36ebd86282bf</parent-transaction-id>
    <account-holder>
        <first-name>Paul</first-name>
        <last-name>Peterson</last-name>
    </account-holder>
    <order-number>1551342687432</order-number>
    <descriptor>Payment description</descriptor>
    <payment-methods>
        <payment-method url="https://demo2.2c2p.com:443/2C2PFrontEnd/SecurePayment/PaymentAuth.aspx?paymentRequest=PFBheW1lbnRSZXF1ZXN0Pjx2ZXJzaW9uPjkuNjwvdmVyc2lvbj48dGltZVN0YW1wPjMwMDYyMDExMTYzMzwvdGltZVN0YW1wPjxtZXJjaGFudElEPm51bGw8L21lcmNoYW50SUQ%2BPHVuaXF1ZVRyYW5zYWN0aW9uQ29kZT4xMzQzMTM2NTg2Nzc1NTE2MzkxMzwvdW5pcXVlVHJhbnNhY3Rpb25Db2RlPjxkZXNjPk4uQTwvZGVzYz48YW10PjAwMDAwMDAwMDIwMDwvYW10PjxjdXJyZW5jeUNvZGU%2BNzY0PC9jdXJyZW5jeUNvZGU%2BPHBheW1lbnRDaGFubmVsPkxJTkU8L3BheW1lbnRDaGFubmVsPjxhZ2VudENvZGU%2BPC9hZ2VudENvZGU%2BPGNoYW5uZWxDb2RlPldFQlBBWTwvY2hhbm5lbENvZGU%2BPG1vYmlsZU5vPjwvbW9iaWxlTm8%2BPGNhcmRob2xkZXJOYW1lPkpvaG48L2NhcmRob2xkZXJOYW1lPjxjYXJkaG9sZGVyRW1haWw%2BPC9jYXJkaG9sZGVyRW1haWw%2BPHVzZXJEZWZpbmVkMT44ZWE1ZmIyZC0yZTJkLTQxNzctOTVmYy00OTEwMzViNzI2YjI8L3VzZXJEZWZpbmVkMT48dXNlckRlZmluZWQyPjE1NTEzNDI2ODc0MzI8L3VzZXJEZWZpbmVkMj48dXNlckRlZmluZWQzPmIxM2ZjMDY5LWMwYmQtNGRiNS04ODhmLTUyMTA5YzQ5ODIxODwvdXNlckRlZmluZWQzPjx1c2VyRGVmaW5lZDQ%2BOWEwNGYzMjgtZWE3ZS00ODdjLWJjY2QtODdmZDU2ZjBkYzA5PC91c2VyRGVmaW5lZDQ%2BPHNlY3VyZUhhc2g%2BNzFGNkVDOUZGNTQ1MDk3RDg2ODdCNzMwQ0NBMjMyNzNFNEZERUIyOTwvc2VjdXJlSGFzaD48L1BheW1lbnRSZXF1ZXN0Pg%3D%3D" name="linepay"/>
    </payment-methods>
    <api-id>---</api-id>
    <cancel-redirect-url>https://{pp-redirect-url-cancel}</cancel-redirect-url>
    <success-redirect-url>https://{pp-redirect-url-success}</success-redirect-url>
    <periodic>
        <periodic-type>recurring</periodic-type>
        <sequence-type>recurring</sequence-type>
    </periodic>
</payment>
----

// include::{root}/samples/xml/_response_success.xml[]

[#API_LinePay_Samples_PendingDebit_RecFinal]
==== _debit_ (Recurring/Final) 

.XML Request (Successful)

[source,xml,subs=attributes+]
----
<payment xmlns="http://www.elastic-payments.com/schema/payment">
  <merchant-account-id>9a04f328-ea7e-487c-bccd-87fd56f0dc09</merchant-account-id>
  <request-id>{{$guid}}</request-id>
  <transaction-type>debit</transaction-type>
  <parent-transaction-id>8ea5fb2d-2e2d-4177-95fc-491035b726b2</parent-transaction-id>
  <payment-methods>
    <payment-method name="linepay"/>
  </payment-methods>
  <periodic>
    <periodic-type>recurring</periodic-type>
    <sequence-type>final</sequence-type>
  </periodic>
</payment>
----

// include::{root}/samples/xml/_request_success.xml[]

.XML Response (Successful)

[source,xml,subs=attributes+]
----
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<payment xmlns="http://www.elastic-payments.com/schema/payment">
    <merchant-account-id>9a04f328-ea7e-487c-bccd-87fd56f0dc09</merchant-account-id>
    <transaction-id>819b4aed-41ee-4ee6-9822-2e2f4aeca704</transaction-id>
    <request-id>2747b197-5f0e-4833-aea1-920bd216b650</request-id>
    <transaction-type>debit</transaction-type>
    <transaction-state>success</transaction-state>
    <completion-time-stamp>2020-06-30T07:28:35.000Z</completion-time-stamp>
    <statuses>
        <status code="201.0000" description="The resource was successfully created." severity="information"/>
    </statuses>
    <requested-amount currency="THB">2.00</requested-amount>
    <parent-transaction-id>8ea5fb2d-2e2d-4177-95fc-491035b726b2</parent-transaction-id>
    <account-holder>
        <first-name>Paul</first-name>
        <last-name>Peterson</last-name>
    </account-holder>
    <order-number>1551342687432</order-number>
    <descriptor>Payment description</descriptor>
    <payment-methods>
        <payment-method url="https://demo2.2c2p.com:443/2C2PFrontEnd/SecurePayment/PaymentAuth.aspx?paymentRequest=PFBheW1lbnRSZXF1ZXN0Pjx2ZXJzaW9uPjkuNjwvdmVyc2lvbj48dGltZVN0YW1wPjMwMDYyMDA3MjgzNTwvdGltZVN0YW1wPjxtZXJjaGFudElEPm51bGw8L21lcmNoYW50SUQ%2BPHVuaXF1ZVRyYW5zYWN0aW9uQ29kZT4xOTc2MTkxMTAzMDk2ODcyNjI5OTwvdW5pcXVlVHJhbnNhY3Rpb25Db2RlPjxkZXNjPk4uQTwvZGVzYz48YW10PjAwMDAwMDAwMDIwMDwvYW10PjxjdXJyZW5jeUNvZGU%2BNzY0PC9jdXJyZW5jeUNvZGU%2BPHBheW1lbnRDaGFubmVsPkxJTkU8L3BheW1lbnRDaGFubmVsPjxhZ2VudENvZGU%2BPC9hZ2VudENvZGU%2BPGNoYW5uZWxDb2RlPldFQlBBWTwvY2hhbm5lbENvZGU%2BPG1vYmlsZU5vPjwvbW9iaWxlTm8%2BPGNhcmRob2xkZXJOYW1lPkpvaG48L2NhcmRob2xkZXJOYW1lPjxjYXJkaG9sZGVyRW1haWw%2BPC9jYXJkaG9sZGVyRW1haWw%2BPHVzZXJEZWZpbmVkMT44MTliNGFlZC00MWVlLTRlZTYtOTgyMi0yZTJmNGFlY2E3MDQ8L3VzZXJEZWZpbmVkMT48dXNlckRlZmluZWQyPjE1NTEzNDI2ODc0MzI8L3VzZXJEZWZpbmVkMj48dXNlckRlZmluZWQzPjI3NDdiMTk3LTVmMGUtNDgzMy1hZWExLTkyMGJkMjE2YjY1MDwvdXNlckRlZmluZWQzPjx1c2VyRGVmaW5lZDQ%2BOWEwNGYzMjgtZWE3ZS00ODdjLWJjY2QtODdmZDU2ZjBkYzA5PC91c2VyRGVmaW5lZDQ%2BPHNlY3VyZUhhc2g%2BODAxOTdCMzVERjI5QjcyNzdGODk0NjA5RThFNDgxRDVFQTFFQUUyMDwvc2VjdXJlSGFzaD48L1BheW1lbnRSZXF1ZXN0Pg%3D%3D" name="linepay"/>
    </payment-methods>
    <api-id>---</api-id>
    <cancel-redirect-url>https://{pp-redirect-url-cancel}</cancel-redirect-url>
    <success-redirect-url>https://{pp-redirect-url-success}</success-redirect-url>
    <periodic>
        <periodic-type>recurring</periodic-type>
        <sequence-type>final</sequence-type>
    </periodic>
</payment>
----

// include::{root}/samples/xml/_response_success.xml[]

[#API_LinePay_Samples_RefundDebit]
==== _refund-debit_

.XML Request (Successful)

[source,xml,subs=attributes+]
----
<payment xmlns="http://www.elastic-payments.com/schema/payment">
  <merchant-account-id>9a04f328-ea7e-487c-bccd-87fd56f0dc09</merchant-account-id>
  <transaction-type>refund-debit</transaction-type>
  <request-id>{{$guid}}</request-id>
  <parent-transaction-id>392e9311-1917-4e95-a7a0-68db64da130a</parent-transaction-id>
  <payment-methods>
    <payment-method name="linepay"/>
  </payment-methods>
</payment>
----

// include::{root}/samples/xml/_request_success.xml[]

.XML Response (Successful)

[source,xml,subs=attributes+]
----
<payment xmlns="http://www.elastic-payments.com/schema/payment" xmlns:ns2="http://www.elastic-payments.com/schema/epa/transaction">
  <merchant-account-id>9a04f328-ea7e-487c-bccd-87fd56f0dc09</merchant-account-id>
  <transaction-id>0c92478c-df87-4943-827c-697ada54e84e</transaction-id>
  <request-id>4d82d877-f211-463f-a282-7446cc85a6b7</request-id>
  <transaction-type>refund-debit</transaction-type>
  <transaction-state>success</transaction-state>
  <completion-time-stamp>2019-02-28T08:32:11.000Z</completion-time-stamp>
  <statuses>
    <status code="201.0000" description="The resource was successfully created." severity="information"/>
  </statuses>
  <requested-amount currency="THB">2.00</requested-amount>
  <parent-transaction-id>392e9311-1917-4e95-a7a0-68db64da130a</parent-transaction-id>
  <account-holder>
    <first-name>Paul</first-name>
    <last-name>Peterson</last-name>
  </account-holder>
  <order-number>1551342687432</order-number>
  <descriptor>Payment description</descriptor>
  <payment-methods>
    <payment-method name="linepay"/>
  </payment-methods>
  <api-id>---</api-id>
  <cancel-redirect-url>https://{pp-redirect-url-cancel}</cancel-redirect-url>
  <success-redirect-url>https://{pp-redirect-url-success}</success-redirect-url>
</payment>
----

// include::{root}/samples/xml/_response_success.xml[]

[#API_LinePay_Samples_PendingAuth]
==== _pending-authorization_

.XML Request (Successful)

[source,xml,subs=attributes+]
----
<payment xmlns="http://www.elastic-payments.com/schema/payment">
  <merchant-account-id>9a04f328-ea7e-487c-bccd-87fd56f0dc09</merchant-account-id>
  <request-id>{{$guid}}</request-id>
  <transaction-type>pending-authorization</transaction-type>
  <requested-amount currency="THB">2.00</requested-amount>
  <account-holder>
    <first-name>Paul</first-name>
    <last-name>Peterson</last-name>
  </account-holder>
  <order-number>1551342687432</order-number>
  <descriptor>Payment description</descriptor>
  <payment-methods>
    <payment-method name="linepay"/>
  </payment-methods>
  <cancel-redirect-url>https://{pp-redirect-url-cancel}</cancel-redirect-url>
  <success-redirect-url>https://{pp-redirect-url-success}</success-redirect-url>
</payment>
----

// include::{root}/samples/xml/_request_success.xml[]

.XML Response (Successful)

[source,xml,subs=attributes+]
----
<payment xmlns="http://www.elastic-payments.com/schema/payment" xmlns:ns2="http://www.elastic-payments.com/schema/epa/transaction">
  <merchant-account-id>9a04f328-ea7e-487c-bccd-87fd56f0dc09</merchant-account-id>
  <transaction-id>c1d9ad1d-ad82-476f-a93d-90febfd08663</transaction-id>
  <request-id>ec669242-a90f-4ee7-aad4-f5af9a0889e1</request-id>
  <transaction-type>pending-authorization</transaction-type>
  <transaction-state>success</transaction-state>
  <completion-time-stamp>2019-02-28T08:31:29.000Z</completion-time-stamp>
  <statuses>
    <status code="201.0000" description="The resource was successfully created." severity="information"/>
  </statuses>
  <requested-amount currency="THB">2.00</requested-amount>
  <account-holder>
    <first-name>Paul</first-name>
    <last-name>Peterson</last-name>
  </account-holder>
  <order-number>1551342687432</order-number>
  <descriptor>Payment description</descriptor>
  <payment-methods>
    <payment-method url="https://sandbox-api-pay.line.me/linepay/v2/web/payment/wait?transactionReserveId=MTM1ODU4NDcyMzc2NzA2Njg4MA==" name="linepay"/>
  </payment-methods>
  <cancel-redirect-url>https://{pp-redirect-url-cancel}</cancel-redirect-url>
  <success-redirect-url>https://{pp-redirect-url-success}</success-redirect-url>
</payment>
----

// include::{root}/samples/xml/_response_success.xml[]

[#API_LinePay_Samples_VoidAuth]
==== _void-authorization_

.XML Request (Successful)

[source,xml,subs=attributes+]
----
<payment xmlns="http://www.elastic-payments.com/schema/payment">
  <merchant-account-id>9a04f328-ea7e-487c-bccd-87fd56f0dc09</merchant-account-id>
  <request-id>{{$guid}}</request-id>
  <transaction-type>void-authorization</transaction-type>
  <parent-transaction-id>e762192b-ffb5-4447-a4a0-4fc1cf9d300a</parent-transaction-id>
  <payment-methods>
    <payment-method name="linepay"/>
  </payment-methods>
</payment>
----

// include::{root}/samples/xml/_request_success.xml[]

.XML Response (Successful)

[source,xml,subs=attributes+]
----
<payment xmlns="http://www.elastic-payments.com/schema/payment" xmlns:ns2="http://www.elastic-payments.com/schema/epa/transaction">
  <merchant-account-id>9a04f328-ea7e-487c-bccd-87fd56f0dc09</merchant-account-id>
  <transaction-id>b7183071-3669-40d1-8cb1-642f495c0aec</transaction-id>
  <request-id>291f22ab-343e-4702-b3a9-ffe4322bdf0b</request-id>
  <transaction-type>void-authorization</transaction-type>
  <transaction-state>success</transaction-state>
  <completion-time-stamp>2019-02-28T08:31:58.000Z</completion-time-stamp>
  <statuses>
    <status code="201.0000" description="The resource was successfully created." severity="information"/>
  </statuses>
  <requested-amount currency="THB">2.00</requested-amount>
  <parent-transaction-id>e762192b-ffb5-4447-a4a0-4fc1cf9d300a</parent-transaction-id>
  <account-holder>
    <first-name>Paul</first-name>
    <last-name>Peterson</last-name>
  </account-holder>
  <order-number>1551342687432</order-number>
  <descriptor>Payment description</descriptor>
  <payment-methods>
    <payment-method name="linepay"/>
  </payment-methods>
  <api-id>---</api-id>
  <cancel-redirect-url>https://{pp-redirect-url-cancel}</cancel-redirect-url>
  <success-redirect-url>https://{pp-redirect-url-success}</success-redirect-url>
</payment>
----

// include::{root}/samples/xml/_response_success.xml[]

[#API_LinePay_Samples_CaptureAuth]
==== _capture-authorization_

.XML Request (Successful)

[source,xml,subs=attributes+]
----
<payment xmlns="http://www.elastic-payments.com/schema/payment">
  <merchant-account-id>9a04f328-ea7e-487c-bccd-87fd56f0dc09</merchant-account-id>
  <request-id>{{$guid}}</request-id>
  <transaction-type>capture-authorization</transaction-type>
  <parent-transaction-id>2636cd44-bd57-427f-a502-702f9c59598f</parent-transaction-id>
  <payment-methods>
    <payment-method name="linepay"/>
  </payment-methods>
</payment>
----

// include::{root}/samples/xml/_request_success.xml[]

.XML Response (Successful)

[source,xml,subs=attributes+]
----
<payment xmlns="http://www.elastic-payments.com/schema/payment" xmlns:ns2="http://www.elastic-payments.com/schema/epa/transaction">
  <merchant-account-id>9a04f328-ea7e-487c-bccd-87fd56f0dc09</merchant-account-id>
  <transaction-id>76a16306-904f-4491-8f5c-811fda31d668</transaction-id>
  <request-id>c414b976-105f-4fab-bfd4-18f14b720668</request-id>
  <transaction-type>capture-authorization</transaction-type>
  <transaction-state>success</transaction-state>
  <completion-time-stamp>2019-02-28T08:31:40.000Z</completion-time-stamp>
  <statuses>
    <status code="201.0000" description="The resource was successfully created." severity="information"/>
  </statuses>
  <requested-amount currency="THB">2.00</requested-amount>
  <parent-transaction-id>2636cd44-bd57-427f-a502-702f9c59598f</parent-transaction-id>
  <account-holder>
    <first-name>Paul</first-name>
    <last-name>Peterson</last-name>
  </account-holder>
  <order-number>1551342687432</order-number>
  <descriptor>Payment description</descriptor>
  <payment-methods>
    <payment-method name="linepay"/>
  </payment-methods>
  <api-id>---</api-id>
  <cancel-redirect-url>https://{pp-redirect-url-cancel}</cancel-redirect-url>
  <success-redirect-url>https://{pp-redirect-url-success}</success-redirect-url>
</payment>
----

// include::{root}/samples/xml/_response_success.xml[]

[#API_LinePay_Samples_RefundCapture]
==== _refund-capture_

.XML Request (Successful)

[source,xml,subs=attributes+]
----
<payment xmlns="http://www.elastic-payments.com/schema/payment">
  <merchant-account-id>9a04f328-ea7e-487c-bccd-87fd56f0dc09</merchant-account-id>
  <request-id>{{$guid}}</request-id>
  <transaction-type>refund-capture</transaction-type>
  <parent-transaction-id>76a16306-904f-4491-8f5c-811fda31d668</parent-transaction-id>
  <payment-methods>
    <payment-method name="linepay"/>
  </payment-methods>
</payment>
----

// include::{root}/samples/xml/_request_success.xml[]

.XML Response (Successful)

[source,xml,subs=attributes+]
----
<payment xmlns="http://www.elastic-payments.com/schema/payment" xmlns:ns2="http://www.elastic-payments.com/schema/epa/transaction">
  <merchant-account-id>9a04f328-ea7e-487c-bccd-87fd56f0dc09</merchant-account-id>
  <transaction-id>7bbd9f0b-99ef-4eeb-89d1-0b436be07942</transaction-id>
  <request-id>c40bcb24-473c-4efd-9467-9589a943fe85</request-id>
  <transaction-type>refund-capture</transaction-type>
  <transaction-state>success</transaction-state>
  <completion-time-stamp>2019-02-28T08:31:43.000Z</completion-time-stamp>
  <statuses>
    <status code="201.0000" description="The resource was successfully created." severity="information"/>
  </statuses>
  <requested-amount currency="THB">2.00</requested-amount>
  <parent-transaction-id>76a16306-904f-4491-8f5c-811fda31d668</parent-transaction-id>
  <account-holder>
    <first-name>Paul</first-name>
    <last-name>Peterson</last-name>
  </account-holder>
  <order-number>1551342687432</order-number>
  <descriptor>Payment description</descriptor>
  <payment-methods>
    <payment-method name="linepay"/>
  </payment-methods>
  <api-id>---</api-id>
  <cancel-redirect-url>https://{pp-redirect-url-cancel}</cancel-redirect-url>
  <success-redirect-url>https://{pp-redirect-url-success}</success-redirect-url>
</payment>
----

// include::{root}/samples/xml/_response_success.xml[]

//-
